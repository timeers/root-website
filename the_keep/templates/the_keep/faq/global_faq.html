{% extends 'the_keep/base.html' %}
{% load i18n static %}


{% block meta %}    <!-- Open Graph tags -->
<meta property="og:type" content="website">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
<meta property="og:image" content="{% if expansion.picture %}{{ expansion.picture.url }}{% else %}{% static 'images/law-icon.png' %}{% endif %}">
{% comment %} <meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" /> {% endcomment %}
<meta property="og:site_name" content="Root Database">
<meta property="og:title" content="{{ faq_title }}">
<meta property="og:description" content="{{ faq_description }}">
<meta name="description" content="{{ faq_description }}">
{% endblock meta%}

{% block content %}


{% if expansion %}
<div class='mb-2 d-flex justify-content-between'>

  <a href="{{ expansion.get_absolute_url }}?lang={{language_code}}" class="content-box d-flex align-items-center clickable-segment text-center">
    <div class='d-flex align-items-center me-1'>
      <i class="bi bi-chevron-left"></i> 
      </div>
      <div class='d-flex mx-auto'>
        {{expansion.title}}
      </div>
  </a>


</div>
{% endif %}


<article class="content-section">
  <div class="d-flex justify-content-between align-items-center">
    <div>
    </div>
      <h1 class='root-title'>{{ faq_title }}</h1>

    <div>
 
      {% if available_languages %}
            
            <div class="dropdown d-inline">
              <button class="btn btn-sm dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <small><i class="bi bi-translate"></i> {{ selected_language.name }}</small>
              </button>
              <ul class="dropdown-menu" aria-labelledby="languageDropdown">

                {% for lang in available_languages %}
                  <li>
                    {% if expansion_slug %}
                      <a class="dropdown-item" href="{% url 'expansion-faq' language_code=lang.code expansion_slug=expansion_slug %}"><small>{{ lang.name }}</small></a>
                    {% else %}
                      <a class="dropdown-item" href="{% url 'faq-home-lang' language_code=lang.code %}"><small>{{ lang.name }}</small></a>
                    {% endif %}
                  </li>
                {% endfor %}
          
              </ul>
            </div>
        
      {% else %}
        <small>
            {{ selected_language }}
        </small>
      {% endif %}

    </div>
  </div>


<form id="faq-search-form" 
hx-get="{% if expansion_slug %}{% url 'expansion-faq' language_code=language_code expansion_slug=expansion_slug %}{% else %}{% url 'faq-home-lang' language_code=language_code %}{% endif %}" 
hx-target="#faq-results" 
hx-swap="innerHTML"
hx-trigger="submit, input delay:300ms" 
autocomplete="off"
class="mx-auto d-flex align-items-center mb-2 gap-2"
style='max-width: 800px;'>
    <input type="text" name="q" placeholder="Search FAQs..." class="form-control">



    <!-- Hidden field to hold the selected type -->
    <input type="hidden" name="type" id="faq-type-value" value="all">
    {% if not expansion_slug %}
    <!-- Segmented Button Group -->
    <div class="btn-group ms-2" role="group" aria-label="FAQ type filter" id="faq-type-buttons">
      <button type="button" class="btn btn-outline-secondary" data-type="official">Official</button>
      <button type="button" class="btn btn-outline-secondary active" data-type="all">All</button>
      <button type="button" class="btn btn-outline-secondary" data-type="fan">Fan</button>
    </div>
    {% endif %}
  </form>
  


  <div id="faq-results">
    {% include 'the_keep/faq/partials/global_faq_list.html' with faqs=faqs %}
  </div>
</article>

    <!-- Option to send Feedback -->
     <div class='mb-2 d-flex justify-content-between'>
        <a href="{% url 'faq-feedback' %}" class='subtle-link'>
            <small>
                {% trans 'Is something missing or incorrect?' %}
            </small>
        </a>
     </div>

{% endblock %}

{% block scripts %}

  <script>
    function toggleAccordion(header) {
      const item = header.parentElement;
      const allItems = document.querySelectorAll('.accordion-item');
      allItems.forEach(i => {
        if (i !== item) i.classList.remove('active');
      });
      item.classList.toggle('active');
    }


  document.addEventListener("DOMContentLoaded", () => {
    const buttons = document.querySelectorAll("#faq-type-buttons button");
    const hiddenInput = document.getElementById("faq-type-value");

    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        buttons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        hiddenInput.value = btn.getAttribute("data-type");

        // Trigger HTMX form submission manually
        document.getElementById("faq-search-form").dispatchEvent(new Event("submit", { bubbles: true }));
      });
    });
  });




  </script>

{% endblock scripts %}