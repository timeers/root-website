{% extends 'the_keep/base.html' %}
{% load static i18n %}

{% block meta %}    <!-- Open Graph tags -->
<meta property="og:type" content="website">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
<meta property="og:image" content="{% static 'images/archive-icon.png' %}">
<meta property="og:site_name" content="{{site_title}}">
<meta property="og:title" content="{{meta_title}}">
<meta property="og:description" content="{{meta_description}}">
<meta name="description" content="{{meta_description}}">
{% endblock meta%}

{% block content %}
<h1 class='root-title'>Advanced Search</h1>

 <ul class="nav nav-tabs mb-3">
    {% for tab in tabs %}
        <li class="nav-item">
          {% if component_type == tab %}
            <a class="nav-link {% if component_type == tab %}active{% endif %}">
                {% if tab == "Tweak" %}
                    House Rule
                {% else %}
                {{ tab }}
                {% endif %}
            </a>
          {% else %}
            <a class="nav-link {% if component_type == tab %}active{% endif %}"
                href="{% url 'advanced-search' component_type=tab|lower %}?search={{search}}&status={{status}}&designer={{selected_designer}}&language_code={{selected_language}}&expansion={{selected_expansion}}&animal={{animal}}&color={{color}}">
                {% if tab == "Tweak" %}
                    House Rule
                {% else %}
                {{ tab }}
                {% endif %}
            </a>
          {% endif %}
        </li>
    {% endfor %}
  </ul>
  

<article class="media content-section mt-2">
    <div class="media-body">
        <form id='advanced-search-form' class="mb-2" method="get" action="">

            {% comment %} <input type="text" name="search" placeholder="Search name or animal..." value="{{ search }}"> {% endcomment %}
            <input type="text" name="search" id="search" placeholder="Search by Name..." value="{{ search }}" class="form-control mb-1">
            {% if component_type == "Faction" or component_type == "Hireling" or component_type == "Vagabond" or component_type == "Clockwork" %}
                <input type="text" name="animal" id="animal" placeholder="Search by Animal..." value="{{ animal }}" class="form-control mb-1">
            {% endif %}
            <div>
            <!-- Designer Search Dropdown -->
            <select name="designer" id="designer-select" class="form-select" aria-label="Select Designer">
                <option value="">{% trans 'Select Designer' %}</option>
                {% for designer in designers %}
                    <option value="{{ designer.id }}" {% if selected_designer == designer.id|stringformat:"s" %}selected{% endif %}>
                        {{ designer }}
                    </option>
                {% endfor %}
            </select>
            {% if artists %}
            <select name="artist" id="artist-select" class="form-select" aria-label="Select Artist">
                <option value="">{% trans 'Select Artist' %}</option>
                {% for artist in artists %}
                    <option value="{{ artist.id }}" {% if selected_artist == artist.id|stringformat:"s" %}selected{% endif %}>
                        {{ artist }}
                    </option>
                {% endfor %}
            </select>
            {% endif %}

            <select id="status" name="status" value="{{ status }}">
                <option value="">{% trans 'Status (All)' %}</option>  
                <option value="1" {% if status == '1' %}selected{% endif %}>{% trans 'Stable' %}</option>
                <option value="2" {% if status == '2' %}selected{% endif %}>{% trans 'Testing' %}</option>
                <option value="3" {% if status == '3' %}selected{% endif %}>{% trans 'Development' %}</option>
                <option value="4" {% if status == '4' %}selected{% endif %}>{% trans 'Inactive' %}</option>
            </select>

            <div>
            <select name="language_code" id="language-select" class="form-select" aria-label="Select Language">
                <option value="">{% trans 'Select Language' %}</option>
                {% for language in used_languages %}
                    <option value="{{ language.code }}" {% if language.code == selected_language %}selected{% endif %}>
                        {{ language }}
                    </option>
                {% endfor %}
            </select>
            {% if expansions %}
            <select name="expansion" id="expansion-select" class="form-select" aria-label="Select Expansion">
                <option value="">{% trans 'Select Expansion' %}</option>
                {% for expansion in expansions %}
                    <option value="{{ expansion.id }}" {% if expansion.id|stringformat:"s" == selected_expansion %}selected{% endif %}>
                        {{ expansion }}
                    </option>
                {% endfor %}
            </select>
            {% endif %}
        </div>
            {% if user.is_authenticated and not user.profile.weird %}
                <div>
                    <small>*Displaying Official Content Only</small>
                </div>
            {% endif %}
        </div>
        
        {% if component_type == "Faction" %}
            {% include "the_keep/partials/advanced_search_faction.html" %}
        {% endif %}

        {% include "the_keep/partials/adv_quantity_filter.html" with prefix="warrior" label="Warrior" op=warrior_op qty=warrior_qty %}
        {% include "the_keep/partials/adv_quantity_filter.html" with prefix="building" label="Building" op=building_op qty=building_qty %}
        {% include "the_keep/partials/adv_quantity_filter.html" with prefix="token" label="Token" op=token_op qty=token_qty %}
        {% include "the_keep/partials/adv_quantity_filter.html" with prefix="card" label="Card" op=card_op qty=card_qty %}
        {% include "the_keep/partials/adv_quantity_filter.html" with prefix="other" label="Other" op=other_op qty=other_qty %}

          
          <div class="mt-3">
            <button type="submit" class="btn btn-primary">
                {% trans "Search" %}
            </button>
        </div>
        
        </form>

    </div>
</article>



    {% include 'the_keep/partials/advanced_search_results.html' %}


{% endblock content %}

{% block scripts %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.querySelector("form");
        form.addEventListener("submit", function (e) {
            const inputs = form.querySelectorAll("input, select");
            inputs.forEach(input => {
                if (input.value === "") {
                    input.disabled = true;  // Disabled fields are not submitted
                }
            });
        });
    });
</script>
    
{% endblock scripts %}