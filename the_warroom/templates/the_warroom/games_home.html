{% extends 'the_keep/base.html' %}
{% load static i18n %}
{% block title %}Games | {% endblock %}
{% block main_width_class %}col-md-9{% endblock %}
{% block meta %}
    <!-- Open Graph tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:image" content="{% static 'images/battlefield-icon.png' %}">
    <meta property="og:site_name" content="{{ site_title }}">

    {% trans "The Battlefield" as battlefield_title %}
    {% trans "Record and view games of Root to track Faction and Player stats" as battlefield_description %}

    <meta property="og:title" content="{{ battlefield_title }}">
    <meta property="og:description" content="{{ battlefield_description }}">
    <meta name="description" content="{{ battlefield_description }}">
{% endblock meta %}



{% block content %}
{% include 'the_warroom/partials/warroom_nav_header.html' with active_page='games' %}

{% url 'games-home' as filter_url %}
{% include 'the_warroom/partials/universal_game_filter.html' with form=form filter_url=filter_url %}

{% include 'the_warroom/partials/game_list_home.html' %}
    
    

    
{% endblock content %} 


{% block scripts %}
    <script>
        // Universal select2 initialization - handles both singular and plural field names
        const selectPlaceholders = {
            '#id_faction': "{% trans 'Select Factions' %}",
            '#id_factions': "{% trans 'Select Factions' %}",
            '#id_player': "{% trans 'Select Players' %}",
            '#id_players': "{% trans 'Select Players' %}",
            '#id_vagabond': "{% trans 'Select Vagabonds' %}",
            '#id_vagabonds': "{% trans 'Select Vagabonds' %}",
            '#id_map': "{% trans 'Select a Map' %}",
            '#id_deck': "{% trans 'Select a Deck' %}"
        };

        // Apply select2 only to fields that exist on the page
        Object.keys(selectPlaceholders).forEach(id => {
            if ($(id).length) {
                $(id).select2({
                    placeholder: selectPlaceholders[id],
                    allowClear: true,
                    width: '100%'
                });
            }
        });

        if ($('#id_official').length) {
            $('#id_official').select2({
                width: '100%'
            });
        }


        // Get the collapse element and button
        const collapseElement = document.getElementById('collapseRegister');
        const collapseToggleButton = document.getElementById('collapseToggleButton');
        if (collapseElement && collapseToggleButton) {
            // Add event listeners to the collapse element
            collapseElement.addEventListener('show.bs.collapse', function () {
                // Change button text to "Hide" when collapse is shown
                collapseToggleButton.innerHTML = 'Hide';
            });

            collapseElement.addEventListener('hide.bs.collapse', function () {
                // Change button text to "View" when collapse is hidden
                collapseToggleButton.innerHTML = 'View';
            });

        }

        // Handle navigation tab clicks to transfer filters
        document.addEventListener('DOMContentLoaded', function() {
            const leaderboardTab = document.querySelector('a.warroom-nav-tab[href="{% url 'leaderboard-view' %}"]');

            if (leaderboardTab) {
                leaderboardTab.addEventListener('click', function(e) {
                    e.preventDefault();
                    const form = document.getElementById('gamefilterform');
                    form.removeAttribute('hx-get');
                    form.action = "{% url 'leaderboard-view' %}";
                    form.submit();
                });
            }
        });
    </script>
{% endblock %}